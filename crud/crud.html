<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SPA CRUD (jQuery + JSONPlaceholder)</title>

  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
  
    body { background:#f7f7f7; }
    .spinner-center { display:flex; align-items:center; justify-content:center; min-height:120px; }
    .card-list .card { min-height: 160px; }
    .toast-container { position: fixed; top: 1rem; right: 1rem; z-index: 2000; }
    .cursor-pointer { cursor:pointer; }
  </style>
</head>
<body>

<div class="container py-4">
  <header class="d-flex align-items-center mb-4">
    <h1 class="h4 mb-0 me-3">CRUD Demo â€” Posts</h1>
    
  </header>

  <!-- Create Form -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Create new post</h5>
      <form id="createForm" class="row g-3" aria-label="Create post form">
        <div class="col-md-6">
          <label for="createTitle" class="form-label">Title</label>
          <input id="createTitle" class="form-control" required aria-describedby="titleHelp">
          <div id="titleHelp" class="form-text">At least 3 characters.</div>
        </div>
        <div class="col-md-6">
          <label for="createUserId" class="form-label">User ID</label>
          <input id="createUserId" class="form-control" type="number" min="1" value="1" required>
        </div>
        <div class="col-12">
          <label for="createBody" class="form-label">Body</label>
          <textarea id="createBody" class="form-control" rows="3" required></textarea>
        </div>

        <div class="col-12 d-flex gap-2">
          <button type="submit" class="btn btn-primary">Create</button>
          <button id="clearCreate" type="button" class="btn btn-outline-secondary">Clear</button>
          <div id="createSpinner" class="spinner-border spinner-border-sm text-primary ms-2 d-none" role="status" aria-hidden="true"></div>
        </div>
      </form>
    </div>
  </div>

 
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <button id="refreshBtn" class="btn btn-outline-secondary btn-sm">Refresh list</button>
      <button id="toggleView" class="btn btn-outline-secondary btn-sm ms-2">Switch to cards</button>
    </div>
    <div>
      <input id="searchInput" class="form-control form-control-sm" placeholder="Search title..." style="min-width:220px">
    </div>
  </div>


  <div id="resultsArea">
  
    <div id="loading" class="spinner-center mb-3">
      <div class="text-center">
        <div class="spinner-border text-primary" role="status" aria-hidden="true"></div>
        <div class="mt-2 text-muted">Loading posts...</div>
      </div>
    </div>

    <div id="tableView" class="table-responsive d-none">
      <table class="table table-hover align-middle bg-white shadow-sm">
        <thead class="table-light">
          <tr>
            <th style="width:60px">ID</th>
            <th>Title</th>
            <th style="width:90px">User</th>
            <th style="width:180px">Actions</th>
          </tr>
        </thead>
        <tbody id="postsTableBody"></tbody>
      </table>
    </div>

    <div id="cardView" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 d-none card-list"></div>

  </div>
</div>


<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <form id="editForm" class="needs-validation" novalidate>
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Edit Post</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="editId">
          <div class="mb-3">
            <label for="editTitle" class="form-label">Title</label>
            <input id="editTitle" class="form-control" required>
            <div class="invalid-feedback">Title must be at least 3 chars.</div>
          </div>
          <div class="mb-3">
            <label for="editBody" class="form-label">Body</label>
            <textarea id="editBody" class="form-control" rows="5" required></textarea>
            <div class="invalid-feedback">Body is required.</div>
          </div>
          <div class="mb-3">
            <label for="editUserId" class="form-label">User ID</label>
            <input id="editUserId" type="number" class="form-control" min="1" required>
            <div class="invalid-feedback">User ID required.</div>
          </div>
          <div id="editSpinner" class="spinner-border spinner-border-sm text-primary d-none" role="status" aria-hidden="true"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button id="saveEdit" type="submit" class="btn btn-primary">Save changes</button>
        </div>
      </form>
    </div>
  </div>
</div>


<div class="toast-container p-3">
  <div id="liveToast" class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastBody">Success</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>


<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center">
        <p class="mb-3">Are you sure you want to delete this item?</p>
        <div class="d-flex justify-content-center gap-2">
          <button id="confirmDeleteBtn" class="btn btn-danger btn-sm">Delete</button>
          <button class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>


const API_BASE = 'https://jsonplaceholder.typicode.com/posts';
let posts = [];           
let deleteTargetId = null; 

$(function() {
  const $loading = $('#loading');
  const $tableBody = $('#postsTableBody');
  const $cardView = $('#cardView');
  const $tableView = $('#tableView');
  const $cardBtn = $('#toggleView');
  const toastEl = document.getElementById('liveToast');
  const bsToast = new bootstrap.Toast(toastEl);

  
  function showToast(message, type='primary') {
    $('#liveToast').removeClass('text-bg-primary text-bg-success text-bg-danger text-bg-warning');
    $('#liveToast').addClass('text-bg-' + (type || 'primary'));
    $('#toastBody').text(message);
    bsToast.show();
  }

  function renderTable(list) {
    $tableBody.empty();
    if (!list.length) {
      $tableBody.append('<tr><td colspan="4" class="text-center text-muted py-4">No items</td></tr>');
      return;
    }
    list.forEach(item => {
      const tr = $(`
        <tr data-id="${item.id}">
          <td>${item.id}</td>
          <td>${escapeHtml(item.title)}</td>
          <td>${item.userId}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary me-1 edit-btn">Edit</button>
            <button class="btn btn-sm btn-outline-danger delete-btn">Delete</button>
          </td>
        </tr>
      `);
      $tableBody.append(tr);
    });
  }

  function renderCards(list) {
    $cardView.empty();
    if (!list.length) {
      $cardView.append('<div class="col-12"><div class="alert alert-secondary">No items</div></div>');
      return;
    }
    list.forEach(item => {
      const card = $(`
        <div class="col">
          <div class="card h-100 shadow-sm">
            <div class="card-body d-flex flex-column">
              <h6 class="card-title">${escapeHtml(item.title)}</h6>
              <p class="card-text text-muted small mb-2">${escapeHtml(truncate(item.body, 120))}</p>
              <div class="mt-auto d-flex justify-content-between align-items-center">
                <small class="text-muted">User ${item.userId}</small>
                <div>
                  <button class="btn btn-sm btn-outline-primary me-1 edit-btn">Edit</button>
                  <button class="btn btn-sm btn-outline-danger delete-btn">Delete</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `);
      card.data('id', item.id);
      $cardView.append(card);
    });
  }

  // utility
  function escapeHtml(s) {
    return $('<div>').text(s).html();
  }
  function truncate(s, n) {
    if (!s) return '';
    return s.length > n ? s.slice(0,n) + '...' : s;
  }

  
  function loadPosts() {
    $loading.show();
    $tableView.addClass('d-none'); $cardView.addClass('d-none');
    $.get(API_BASE + '?_limit=10')
      .done(function(data) {
        posts = data.slice();
        renderTable(posts);
        renderCards(posts);
        $tableView.removeClass('d-none');
      })
      .fail(function() {
        showToast('Failed to load posts', 'danger');
      })
      .always(function() {
        $loading.hide();
      });
  }

  loadPosts();

  // toggle view
  let isTable = true;
  $cardBtn.on('click', function() {
    isTable = !isTable;
    if (isTable) {
      $('#tableView').removeClass('d-none');
      $('#cardView').addClass('d-none');
      $(this).text('Switch to cards');
    } else {
      $('#tableView').addClass('d-none');
      $('#cardView').removeClass('d-none');
      $(this).text('Switch to table');
    }
  });

 
  $('#searchInput').on('input', function() {
    const q = $(this).val().toLowerCase().trim();
    const filtered = posts.filter(p => p.title.toLowerCase().includes(q) || p.body.toLowerCase().includes(q));
    renderTable(filtered);
    renderCards(filtered);
  });

  $('#createForm').on('submit', function(e) {
    e.preventDefault();
    const title = $('#createTitle').val().trim();
    const body = $('#createBody').val().trim();
    const userId = parseInt($('#createUserId').val(),10) || 1;

    if (!title || title.length < 3) { showToast('Title must be at least 3 chars', 'warning'); return; }
    if (!body) { showToast('Body required', 'warning'); return; }

    $('#createSpinner').removeClass('d-none');
   
    $.ajax({
      url: API_BASE,
      method: 'POST',
      data: JSON.stringify({ title, body, userId }),
      contentType: 'application/json; charset=UTF-8'
    })
    .done(function(resp) {
      
      posts.unshift(resp);
      renderTable(posts);
      renderCards(posts);
      showToast('Created successfully', 'success');
      $('#createForm')[0].reset();
    })
    .fail(function() {
      showToast('Create failed', 'danger');
    })
    .always(function() {
      $('#createSpinner').addClass('d-none');
    });
  });

  $('#clearCreate').on('click', function(){ $('#createForm')[0].reset(); });


  $('#postsTableBody, #cardView').on('click', '.edit-btn', function() {
    
    const $row = $(this).closest('[data-id]');
    const id = $row.data('id') || $(this).closest('.col').data('id');
    openEditModal(id);
  });

  $('#postsTableBody, #cardView').on('click', '.delete-btn', function() {
    const $row = $(this).closest('[data-id]');
    const id = $row.data('id') || $(this).closest('.col').data('id');
    deleteTargetId = id;
    const md = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
    md.show();
  });

 
  function openEditModal(id) {
    const item = posts.find(p => p.id == id);
    if (!item) { showToast('Item not found', 'warning'); return; }
    $('#editId').val(item.id);
    $('#editTitle').val(item.title);
    $('#editBody').val(item.body);
    $('#editUserId').val(item.userId);
    $('#editModal').modal && $('#editModal').modal('show');

    const modal = new bootstrap.Modal(document.getElementById('editModal'));
    modal.show();
  }

  $('#editForm').on('submit', function(e) {
    e.preventDefault();
    const id = $('#editId').val();
    const title = $('#editTitle').val().trim();
    const body = $('#editBody').val().trim();
    const userId = parseInt($('#editUserId').val(),10) || 1;
    if (!title || title.length < 3) {
      $('#editTitle').addClass('is-invalid');
      return;
    } else $('#editTitle').removeClass('is-invalid');

    $('#editSpinner').removeClass('d-none');
    $.ajax({
      url: API_BASE + '/' + id,
      method: 'PUT',
      data: JSON.stringify({ id, title, body, userId }),
      contentType: 'application/json; charset=UTF-8'
    })
    .done(function(resp) {
      
      const idx = posts.findIndex(p => p.id == id);
      if (idx > -1) posts[idx] = resp;
      renderTable(posts);
      renderCards(posts);
      showToast('Updated successfully', 'success');
      const modal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
      modal.hide();
    })
    .fail(function() {
      showToast('Update failed', 'danger');
    })
    .always(function() {
      $('#editSpinner').addClass('d-none');
    });
  });


  $('#confirmDeleteBtn').on('click', function() {
    if (!deleteTargetId) return;
    const id = deleteTargetId;
    
    $(this).prop('disabled', true).text('Deleting...');
    $.ajax({
      url: API_BASE + '/' + id,
      method: 'DELETE'
    })
    .done(function() {
     
      posts = posts.filter(p => p.id != id);
      renderTable(posts);
      renderCards(posts);
      showToast('Deleted', 'success');
      deleteTargetId = null;
      const md = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
      md.hide();
    })
    .fail(function() {
      showToast('Delete failed', 'danger');
    })
    .always(function() {
      $('#confirmDeleteBtn').prop('disabled', false).text('Delete');
    });
  });

 
  $('#refreshBtn').on('click', function(){ loadPosts(); showToast('Refreshed', 'primary'); });

  
  $('#createForm').on('invalid', function(e){
    e.preventDefault();
    const firstInvalid = $(this).find(':invalid').first();
    if (firstInvalid.length) firstInvalid.focus();
  });


  function initialRender() {
    renderTable(posts);
    renderCards(posts);
  }

 
  setTimeout(()=>{ $loading.hide(); if(!posts.length) initialRender(); }, 5000);

});
</script>
</body>
</html>
